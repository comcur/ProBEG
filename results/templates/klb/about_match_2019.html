{% extends 'results/base.html' %}
{% load staticfiles %}
{% load results_extras %}
{% block main %}
<div class="row"> <!-- Name, old link -->
	<div class="col-md-7">
		<h3>Приглашаем клубы любителей бега и самих любителей бега принять участие <nobr>в КЛБМатче–{{ year }}!</nobr></h3>
		{% if this_is_old_match %}
			<div class="alert alert-danger" role="alert">
				Это — страница об уже завершившемся матче. Информацию о текущем КЛБМатче вы можете найти
				<a href="{% url 'results:about_match' %}" class="underlined">по ссылке</a>.
			</div>
		{% endif %}
		<p>Это — заочное соревнование и между клубами, и среди всех желающих любителей бега.
		<br/>
		В зачёт идут как скорость (<strong>четыре</strong> лучших результата на дистанциях от 10 км), так и общий километраж, который вы наберёте
		на соревнованиях за год (учитывается сумма 18 самых длинных забегов).</p>
		<div class="alert alert-warning" role="alert">
			Самое главное:
			<a href="#results_counted" class="dash-underlined">какие результаты учитываются</a>,
			<a href="#how_to_apply" class="dash-underlined">как заявить команду или себя лично</a>,
			<a href="#changes" class="dash-underlined">изменения в {{ year }} году</a>
		</div>
		<h4>Кто участвует?</h4>
		Кто только не. В <a href="{% url 'results:klb_match_summary' year=year|add:-1 %}" target="_blank">девятом КЛБМатче</a>,
		который сейчас завершается, соревнуются 104 команды из самых разных краёв России, Украины, Беларуси и Казахстана,
		а также клубы, не привязанные ни к какому региону, и индивидуальные участники; всего 2590 человек от 9 до 86 лет.
		<br/>
		О матчах 2010-2017 годов можно почитать
		на <a href="http://probeg.org/klb/" target="_blank">странице истории КЛБМатчей</a>.
		<br/><br/>
		<h4>Как могут соревноваться 9- и 86-летние?</h4>
		Могут, причём практически на равных с находящимися в расцвете сил. При расчете результатов мы используем сложную, отработанную годами
		формулу (см. пункт 7.3 <a href="{% static regulations_link %}" target="_blank">Положения</a>),
		учитывающую длину дистанции и возраст участника. Для учёта возраста мы используем
		<a href="http://www.howardgrubb.co.uk/athletics/wmaroad15.html" target="_blank">возрастные коэффициенты</a>,
		утверждённые организацией
		<a href="http://www.world-masters-athletics.org/" target="_blank">World Masters Athletics</a>,
		координирующей соревнования по бегу среди ветеранов.
		В результате в первой десятке есть любители бега от 1956 до 1993 годов рождения,
		в <a href="{% url 'results:klb_age_group_details' age_group_id=203 %}" target="_blank">первой сотне</a> — от 1940-го до 1995-го.
		<br/>
		Кроме того, награждаются и победители в 13 возрастных группах у мужчин и тех же возрастных группах у женщин.
		<br/><br/>
		<h4>А как большие клубы могут соревноваться с маленькими?</h4>
		С трудом. Мы не делаем скидок маленьким клубам, но есть три отдельных клубных зачёта: до 18, до 40 и до 100 участников.
		<br/>
		Если у вас больше 100 человек, вы можете заявить в клуб несколько команд. Это можно сделать и с другими целями —
		например, разделиться внутри клуба на несколько команд и соревноваться между собой. Или разделить клуб на «стар» и «млад» и посмотреть, кто как относится к любимому занятию. Также с этого года мы проводим <strong>первенство команд-дублёров</strong>; подробнее о нём — ниже.
		<br/><br/>
		<h4>Сколько стоит участие?</h4>
		<strong>120 рублей</strong> с человека за весь год. Пенсионеры и инвалиды при желании могут участвовать бесплатно.
		<br/><br/>
		<h4><a name="results_counted"></a>Какие результаты входят в зачёт?</h4>
		Должны быть выполнены несколько несложных условий. Точные правила изложены
		в разделе 8 <a href="{% static regulations_link %}" target="_blank">Положения</a>. Вкратце дело обстоит так:
		<ul>
			<li>Дистанция забега должна быть качественно измерена, её длина должна быть не меньше 9,5 и не больше 300 км
				(это же условие работает и для забегов с фиксированным временем — часовых, суточных и т.п.)</li>
			<li>Если забег проходит в России или Беларуси, информация о нём должна быть размещена на нашем сайте не меньше,
				чем за месяц до старта. Если забега у нас нет, вы сами можете прислать нам информацию о нём; спасибо вам скажем и мы,
				и все посетители сайта.
			</li>
			<li>Протокол забега должен быть доступен в интернете всем желающим.
			</li>
			<li>Если вы выступаете за клуб и в протоколе забега есть графа «Клуб» или аналогичная по смыслу,
				и забег проходит в родной для вас стране, то либо эта графа в вашей строке должна быть пустой,
				либо в ней должно быть указано название вашего клуба (также могут быть указаны и любые другие организации).
			</li>
		</ul>
		<br/>
		<h4>Как считаются очки и бонусы за мой результат?</h4>
		Не очень просто. Сначала умножаем результат в секундах
		на <a href="http://www.howardgrubb.co.uk/athletics/wmaroad15.html" target="_blank">возрастной коэффициент</a>,
		а затем по сложной формуле из пункта 7.3 <a href="{% static regulations_link %}" target="_blank">Положения</a>
		вычисляем спортивные очки. Если вкратце — человек, пробежавший на любой
		дистанции на уровне мастера спорта, получает 9 очков; на уровне третьего разряда — 3 очка; одно очко даём за результат на столько же
		медленнее третьего разряда, насколько третий разряд медленнее мастера спорта на этой дистанции.
		<br/>
		С бонусами всё куда проще: они равны длине преодолённой дистанции в километрах, делённой на <strong>200</strong>.
		Округляются и очки, и бонусы до трёх разрядов после запятой.
		<br/>
		Узнать, сколько очков и бонусов вы получите, если преодолеете в данном возрасте данную дистанцию за данное время, можно на странице
		<a href="{% url 'results:calculator' %}" target="_blank">Расчет очков</a>.
		<br/><br/>
		<h4>А как вычисляются мои очки и очки клуба за весь год?</h4>
		Ваш итоговый результат — сумма <strong>четырёх</strong> максимальных спортивных очков за отдельные выступления и 18 максимальных бонусов (они могут быть взяты с тех же стартов, где вы набрали максимальное число чистых очков, а могут быть — и с совсем других).
		<br/>
		Итоговый результат вашей команды, если вы выступаете за команду, — сумма пятнадцати лучших сумм спортивных очков членов команды (то есть
		у каждого из них берём эти четыре лучших его результата) и бонусов вообще всех членов команды (как мы помним, в зачёт бонусов идут бонусы не за все результаты за год, а только 18 максимальных — то есть, по сути, суммарная длина 18 самых длинных забегов человека за год в километрах, делённая на двести).
		<br/>
		Вот и всё. На странице каждой команды для удобства очки этих 15 человек, чьи спортивные очки идут в зачёт, выделены жирным.
		<br/><br/>
		<h4>Есть ещё какие-нибудь плюшки?</h4>
		Хорошо, что вы спросили! Да, есть. Например, мы сами отслеживаем большинство крупных забегов в России, Украине и Беларуси,
		так что даже без вашего участия отследим и не дадим вам забыть добавить в зачёт матча многие результаты (для этого только в протоколе
		должны быть правильно указаны ваше имя, дата рождения и клуб). В <a href="{% url 'results:results' %}">общей базе результатов</a> их у нас уже {{ n_results }}.
		<br/>
		Также вы получаете личную страничку со всеми вашими забегами (в том числе и не идущими в зачёт КЛБМатча)
		и статистикой по вашим результатам. Правда, если честно, такую страничку может завести себе и просто любой пользователь сайта;
		но ему придётся полагаться только на себя в плане наполнения её результатами.
		<br/><br/>
		<h4><a name="changes"></a>Есть какие-то изменения в {{ year }} году?</h4>
		Да, девять важных изменений:
		<ol>
			<li>Изменена формула матча как в спортивной, так и в бонусной составляющей:
				<ul>
					<li>в спортивные очки идет не 3 лучших результата за год, а 4;</li>
					<li>1 бонусное очко дается не за 100 км, а за 200 км;</li>
					<li>изменены предельные значения для личных бонусов участника — не более 6 за старт и не более 20 в сумме за весь матч.</li>
				</ul>
				Таким образом мы хотим увеличить спортивную направленность матча и конкуренцию в борьбе за первые места во всех зачётах.
			</li>
			<li>В командах-призерах (первые 3 места) в каждом из трёх зачётов медали получают все участники, у которых есть хотя бы 1 зачетный старт.</li>
			<li>Взнос за участие в матче — 120 ₽ за каждого участника. Пенсионеры (мужчины 60 лет и старше, женщины 55 лет и старше) и инвалиды по-прежнему при желании могут не платить взнос.</li>
			<li>В каждой команде должен быть хотя бы один участник, зарегистрированный у нас на сайте и имеющий права самостоятельно вводить результаты членов команды.</li>
			<li>Теперь в зачет идут также и результаты, показанные в день регистрации участника в матч, даже если участник добавлен в команду после финиша.</li>
			<li>Добавлено первенство среди команд-дублеров. В нём могут принять участие все вторые, третьи и т.д. команды клубов, название которых содержит название клуба и в которых состоит не больше 18 человек. Подробнее — в п. 5.6 Положения.</li>
			<li>Возможно удаление из команды участника, уже имеющего результаты в матче. Для этого необходимо выполнения ряда условий; подробнее — п. 6.12 Положения.</li>
			<li>Для дистанций трейлов, имеющих баллы ITRA, к спортивным очкам финишировавших участников добаляются баллы ITRA, делённые на 2 (п. 7.3.1 Положения).</li>
			<li>Введено требование на минимальное число стартовавших участников на зачетной дистанции — не менее 2 человек (п. 8.13 Положения).</li>
		</ol>
		Опытным участникам рекомендуем просмотреть <a href="{% static regulations_changes_link %}" target="_blank">ещё вот этот документ</a>
		— там все изменения в положении по сравнению с прошлым годом, даже мелкие, выделены красным.
		<br/><br/>
		<h4><a name="how_to_apply"></a>Как мне заявить свою команду?</h4>
		Если вы <strong>участвовали в предыдущих матчах</strong>,
		то ваш клуб должен быть на <a href="{% url 'results:clubs' %}" target="_blank">странице клубов-участников</a>.
		Чтобы не <a href="https://ru.wikipedia.org/wiki/Бритва_Оккама" target="_blank">плодить сущности</a>, выберите представителя клуба,
		который будет ответственен за страницу клуба и команды вашего клуба;
		пусть он напишет нам письмо на <a href="mailto:info@probeg.org">info@probeg.org</a>, мы выдадим ему (может, это будете вы?) права,
		и на странице клуба у него появится кнопка «Заявить команду в КЛБМатч–{{ year }}».
		<br/>
		<strong>Пока не участвовали в матчах?</strong> Тогда всё ещё проще!
		<a href="{% url 'probeg_auth:login' %}">Зарегистрируйтесь на сайте</a>
		(или <a href="{% url 'probeg_auth:login' %}">зайдите через какую-нибудь соцсеть</a>)
		и на <a href="{% url 'results:clubs' %}" target="_blank">странице клубов</a> внизу жмите
		«Создать клуб». Придётся только доказать, что вы не робот и что-то знаете о беге.
		<br/><br/>
		Если вы категорически не хотите регистрироваться на сайте, можете по старинке заполнить форму в формате MS Word и прислать нам на <a href="mailto:info@probeg.org">info@probeg.org</a>. Есть три разные формы:
		<a href="http://probeg.org/klb/2019/Zv2_KLBMatch_2019.doc">для команд, участвовавших в КЛБМатче-{{ year|add:-1 }}</a>,
		<a href="http://probeg.org/klb/2019/Zv1_KLBMatch_2019.doc">для всех остальных команд</a> и
		<a href="http://probeg.org/klb/2019/Zv3_KLBMatch_2019.doc">для индивидуальных участников</a>.
		Правда, заполнение и обработка формы займет и у вас, и у нас больше времени, чем если зарегистрируетесь через сайт.
		<br/><br/>
		<h4>А если я не состою ни в каком клубе?</h4>
		Вам — на <a href="{% url 'results:klb_application' year=year %}" target="_blank">страницу подачи заявки индивидуального участника</a>.
		<br/>
		Можете ещё посмотреть на <a href="{% url 'results:clubs' %}" target="_blank">список всех клубов</a>,
		участвовавших в КЛБМатчах в последние годы —
		возможно, захотите присоединиться к какому-то из них? У большинства указана контактная информация.
		<br/><br/>
		<h4>Как оплатить участие?</h4>
		Клубам нужно будет оплатить участие в марте. За это время мы пришлём вам всю информацию. За участников, которых будете заявлять после этого, можно будет сразу участие и оплатить. Индивидуальным участникам нужно оплатить участие до первого выступления в зачёт матча — результаты, показанные до дня оплаты, в зачёт не идут. 
		<br/><br/>
		Вот и всё. Зовите друзей и бегайте в удовольствие!
		<br/><br/>
		И пишите нам на <a href="mailto:info@probeg.org">info@probeg.org</a> или <a href="#" id="send_to_info_page">прямо отсюда</a>,
		если у вас будут любые вопросы.
	</div>
	<div class="col-md-5">
		<h4>КЛБМатч–{{ year_for_results }}: текущее положение</h4>
		<ul class="nav nav-tabs">
			<li class="text-center active">
				<a data-toggle="tab" href="#tab_all">Абсолютный зачёт</a>
			</li>
			<li class="text-center warning">
				<a data-toggle="tab" href="#tab_medium">Средние клубы<br/>({{ small_team_size|add:1 }}–{{ medium_team_size }} человек)</a>
			</li>
			<li class="text-center danger">
				<a data-toggle="tab" href="#tab_small">Маленькие клубы<br/>(до {{ small_team_size }} человек)</a>
			</li>
		</ul>
		<div class="tab-content">
			<div id="tab_all" class="tab-pane fade in active">
				{% include 'klb/teams_table.html' with teams=teams_all full_list=1 %}
			</div>
			<div id="tab_medium" class="tab-pane fade">
				{% include 'klb/teams_table.html' with teams=teams_medium %}
			</div>
			<div id="tab_small" class="tab-pane fade">
				{% include 'klb/teams_table.html' with teams=teams_small %}
			</div>
		</div>
		<h4>Зачёты по группам</h4>
		<table class="table table-condensed table-hover">
			{% for row in groups %}
				{% if not forloop.first %}
					<tr><td colspan="10">&nbsp;</td></tr>
				{% endif %}
				<tr><td colspan="10" class="info text-center">
					<a href="{{ row.group.get_absolute_url }}"><strong>{{ row.group.name }}</strong></a>
					<span class="pull-right">
						Всего участников: {{ row.group.n_participants }}, стартовало: {{ row.group.n_participants_started }}
					</span>
				</tr></td>
				<tr><th></th><th>Имя</th><th class="text-center">Год&nbsp;рожд.</th><th>Команда</th>
					<th>Стартов</th><th class="text-center">Очки</th><th>+</th><th colspan="3">Бонусы</th>
				</tr>
				{% for participant in row.participants %}{% with person=participant.klb_person %}
					<tr{% if person.gender == 1 %} class="success"{% endif %}>
						<td>{{ forloop.counter }}</td>
						<td>
							<a href="{{ person.get_absolute_url }}">{{ person.fname }} {{ person.lname }}</a>
							({{ person.city.nameWithCountry }})
						</td>
						<td class="text-center">{% if person.birthday %}{{ person.birthday.year }}{% endif %}</td>
						<td>{% if participant.team %}
								<a href="{{ participant.team.get_absolute_url }}">{{ participant.team.name }}</a>
							{% endif %}
						</td>
						<td class="text-center">{{ participant.n_starts }}</td>
						<td class="text-right">{{ participant.clean_sum|floatformat:3 }}</td>
						<td>+</td>
						<td class="text-right">{{ participant.bonus_sum|floatformat:3 }}</td>
						<td>=</td>
						<td class="text-right"><strong>{{ participant.score_sum|floatformat:3 }}</strong></td>
					</tr>
				{% endwith %}{% endfor %}
			{% endfor %}
		</table>
	</div>
</div>
{% endblock %}
