{% extends 'results/base.html' %}
{% load staticfiles %}
{% load results_extras %}
{% block main %}
<div class="row"> <!-- Name, old link -->
	<div class="col-md-7">
		<h3>Приглашаем клубы любителей бега и самих любителей бега принять участие в КЛБМатче–2017!</h3>
		{% if this_is_old_match %}
			<div class="alert alert-danger" role="alert">
				Это — страница об уже завершившемся матче. Информацию о текущем КЛБМатче вы можете найти
				<a href="{% url 'results:about_match' %}" class="underlined">по ссылке</a>.
			</div>
		{% endif %}
		Это — заочное соревнование и между клубами, и среди всех желающих любителей бега.
		<br/>
		В зачёт идут как скорость (три лучших результата на дистанциях от 10 км), так и общий километраж, который вы наберёте
		на соревнованиях за год (учитывается сумма 18 самых длинных забегов).
		<br/><br/>
		<h4>Кто участвует?</h4>
		Кто только не. В седьмом КЛБМатче, который сейчас завершается,
		соревнуются 93 команды из самых разных краёв России, Украины, Беларуси и Казахстана,
		а также клубы, не привязанные ни к какому региону, и индивидуальные участники; всего 2294 человека от 9 до 90 лет.
		<br/>
		О матчах 2010–2015 годов и о том, как менялись их правила, можно почитать
		на <a href="http://probeg.org/klb/" target="_blank">странице истории КЛБМатчей</a>.
		<br/><br/>
		<h4>Как могут соревноваться 9- и 90-летние?</h4>
		Могут, причём практически на равных с находящимися в расцвете сил. При расчете результатов мы используем сложную, отработанную годами
		формулу (см. пункт 7.3 <a href="http://probeg.org/klb/2017/Pl_KLBMatch_17.pdf" target="_blank">Положения</a>),
		учитывающую длину дистанции и возраст участника. Для учёта возраста мы с 2017 года переходим на
		<a href="http://www.howardgrubb.co.uk/athletics/wmaroad15.html" target="_blank">новые возрастные коэффициенты</a>,
		уточнённые в 2015 году и утверждённые организацией
		<a href="http://www.world-masters-athletics.org/" target="_blank">World Masters Athletics</a>,
		координирующей соревнования по бегу среди ветеранов.
		В результате в первой десятке есть любители бега от 1948 до 1990 годов рождения,
		в <a href="{% url 'results:klb_age_group_details' age_group_id=29 %}" target="_blank">первой сотне</a> — от 1938-го до 1994-го.
		<br/>
		Кроме того, награждаются и победители в 13 возрастных группах у мужчин и тех же возрастных группах у женщин.
		<br/><br/>
		<h4>А как большие клубы могут соревноваться с маленькими?</h4>
		С трудом. Мы не делаем скидок маленьким клубам, но есть три отдельных клубных зачёта: до 18, до 40 и до 100 участников.
		<br/>
		Если у вас больше 100 человек, вы можете заявить в клуб несколько команд. Это можно сделать и с другими целями —
		например, разделиться внутри клуба на несколько команд и соревноваться между собой.
		<br/><br/>
		<h4>Сколько стоит участие?</h4>
		100 рублей с человека за весь год. Пенсионеры и инвалиды при желании могут участвовать бесплатно.
		<br/><br/>
		<h4>Какие результаты входят в зачёт?</h4>
		Должны быть выполнены несколько несложных условий. Точные правила изложены
		в разделе 8 <a href="http://probeg.org/klb/2017/Pl_KLBMatch_17.pdf" target="_blank">Положения</a>. Вкратце дело обстоит так:
		<ul>
			<li>Дистанция забега должна быть качественно измерена, её длина должна быть не меньше 10 и не больше 300 км
				(это же условие работает и для забегов с фиксированным временем — часовых, суточных и т.п.)</li>
			<li>Если забег проходит в России, Украине или Беларуси, информация о нём должна быть размещена на нашем сайте не меньше,
				чем за месяц до старта. Если забега у нас нет, вы сами можете прислать нам информацию о нём; спасибо вам скажем и мы,
				и все посетители сайта.
			</li>
			<li>Протокол забега должен быть доступен в интернете всем желающим.
			</li>
			<li>Если вы выступаете за клуб и в протоколе забега есть графа «Клуб» или аналогичная по смыслу,
				и забег проходит в родной для вас стране, то либо эта графа в вашей строке должна быть пустой,
				либо в ней должно быть указано название вашего клуба (также могут быть указаны и любые другие организации).
			</li>
		</ul>
		<br/>
		<h4>Как считаются очки и бонусы за мой результат?</h4>
		Не очень просто. Сначала умножаем результат в секундах
		на <a href="http://www.howardgrubb.co.uk/athletics/wmaroad15.html" target="_blank">возрастной коэффициент</a>,
		а затем по сложной формуле из пункта 7.3 <a href="http://probeg.org/klb/2017/Pl_KLBMatch_17.pdf" target="_blank">Положения</a>
		вычисляем чистые очки. Если вкратце — человек, пробежавший на любой
		дистанции на уровне мастера спорта, получает 9 очков; на уровне третьего разряда — 3 очка; одно очко даём за результат на столько же
		медленнее третьего разряда, насколько третий разряд медленнее мастера спорта на этой дистанции.
		<br/>
		С бонусами всё куда проще: они равны длине преодолённой дистанции в километрах, делённой на 100. Округляются и очки, и бонусы до трёх
		разрядов после запятой.
		<br/>
		Узнать, сколько очков и бонусов вы получите, если преодолеете в данном возрасте данную дистанцию за данное время, можно на странице
		<a href="{% url 'results:calculator' %}" target="_blank">Расчет очков</a>.
		<br/><br/>
		<h4>А как вычисляются мои очки и очки клуба за весь год?</h4>
		Ваш итоговый результат — сумма трёх максимальных чистых очков за отдельные выступления и 18 максимальных бонусов (они могут быть взяты с тех же стартов, где вы набрали максимальное число чистых очков, а могут быть — и с совсем других).
		<br/>
		Итоговый результат вашей команды, если вы выступаете за команду, — сумма пятнадцати лучших сумм чистых очков членов команды (то есть
		у каждого из них берём эти три лучших его результата) и бонусов вообще всех членов команды (как мы помним, в зачёт бонусов идут бонусы не за все результаты за год, а только 18 максимальных — то есть, по сути,
		суммарная длина 18 самых длинных забегов человека за год в километрах, делённая на сто).
		<br/>
		Вот и всё. На странице каждой команды для удобства очки этих 15 человек, чьи чистые очки идут в зачёт, выделены жирным.
		<br/><br/>
		<h4>Есть ещё какие-нибудь плюшки?</h4>
		Хорошо, что вы спросили! Да, есть. Например, мы сами отслеживаем большинство крупных забегов в России, Украине и Беларуси,
		так что даже без вашего участия отследим и не дадим вам забыть добавить в зачёт матча многие результаты (для этого только в протоколе
		должны быть правильно указаны ваше имя, дата рождения и клуб).
		<br/>
		Также вы получаете личную страничку со всеми вашими забегами (в том числе и не идущими в зачёт КЛБМатча)
		и статистикой по вашим результатам. Правда, если честно, такую страничку может завести себе и просто любой пользователь сайта;
		но ему придётся полагаться только на себя в плане наполнения её результатами.
		<br/><br/>
		<h4>Есть какие-то измененения в 2017 году?</h4>
		Да, небольшие — мы постарались скорректировать правила так, чтобы сделать борьбу между командами острее. Список основных изменений —
		<a href="http://probeg.org/klb/2017/KLBMatch_2017_new.pdf" target="_blank">здесь</a>.
		<br/><br/>
		<h4>Как же мне заявить свой клуб?</h4>
		Ну наконец-то!
		<br/>
		Если вы <strong>участвовали в предыдущих матчах</strong>,
		то ваш клуб должен быть на <a href="{% url 'results:clubs' %}" target="_blank">странице клубов-участников</a>.
		Чтобы не <a href="https://ru.wikipedia.org/wiki/Бритва_Оккама" target="_blank">плодить сущности</a>, выберите представителя клуба,
		который будет ответственен за страницу клуба и команды вашего клуба,
		пусть он напишет нам письмо на <a href="mailto:klb@probeg.org">klb@probeg.org</a>, мы выдадим ему (может, это будете вы?) права,
		и на странице клуба у него появится кнопка «Заявить команду в КЛБМатч–2017».
		<br/>
		<strong>Пока не участвовали в матчах?</strong> Тогда всё ещё проще!
		Зарегистрируйтесь на сайте (или зайдите через какую-нибудь соцсеть — если вы ещё этого не делали, вас ждёт кнопка «Вход» справа сверху)
		и на <a href="{% url 'results:clubs' %}" target="_blank">странице клубов</a> внизу жмите
		«Создать клуб». Придётся только доказать, что вы не робот и что-то знаете о беге.
		<br/><br/>
		<h4>А если я не состою ни в каком клубе?</h4>
		Тогда всё ещё проще: сразу идите на <a href="{% url 'results:klb_application' %}" target="_blank">страницу подачи заявки</a>.
		<br/>
		Можете ещё посмотреть на <a href="{% url 'results:clubs' %}" target="_blank">список всех клубов</a>,
		участвовавших в КЛБМатчах в последние годы —
		возможно, захотите присоединиться к какому-то из них? У большинства указана контактная информация.
		<br/><br/>
		<h4>Как оплатить участие?</h4>
		Способы оплаты указаны на последней странице <a href="http://probeg.org/klb/2017/Pl_KLBMatch_17.pdf" target="_blank">Положения</a>. 
		Командам спешить не нужно — у вас есть время до 31 марта; если после этого будете
		дозаявлять ещё участников, оплачивайте их уже сразу, как заявляете. До конца марта появится и возможность оплатить участие
		прямо через сайт.
		<br/>
		Индивидуальные же участники должны оплатить участие сразу. Они считаются участниками матча с момента, когда оплатят участие
		и напишут на адрес <a href="mailto:klb@probeg.org">klb@probeg.org</a> способ и время перевода денег.
		<br/><br/>
		Вот и всё. Зовите друзей и бегайте в удовольствие!
		<br/><br/>
		И пишите нам на <a href="mailto:klb@probeg.org">klb@probeg.org</a> или <a href="#" id="send_to_info_page">прямо отсюда</a>,
		если у вас будут любые вопросы.
	</div>
	<div class="col-md-5">
		<h4>КЛБМатч–{{ year }}: текущее положение</h4>
		<ul class="nav nav-tabs">
			<li class="text-center active">
				<a data-toggle="tab" href="#tab_all">Абсолютный зачёт</a>
			</li>
			<li class="text-center warning">
				<a data-toggle="tab" href="#tab_medium">Средние клубы<br/>({{ small_team_size|add:1 }}–{{ medium_team_size }} человек)</a>
			</li>
			<li class="text-center danger">
				<a data-toggle="tab" href="#tab_small">Маленькие клубы<br/>(до {{ small_team_size }} человек)</a>
			</li>
		</ul>
		<div class="tab-content">
			<div id="tab_all" class="tab-pane fade in active">
				{% include 'klb/teams_table.html' with teams=teams_all full_list=1 %}
			</div>
			<div id="tab_medium" class="tab-pane fade">
				{% include 'klb/teams_table.html' with teams=teams_medium %}
			</div>
			<div id="tab_small" class="tab-pane fade">
				{% include 'klb/teams_table.html' with teams=teams_small %}
			</div>
		</div>
		<h4>Зачёты по группам</h4>
		<table class="table table-condensed table-hover">
			{% for row in groups %}
				{% if not forloop.first %}
					<tr><td colspan="10">&nbsp;</td></tr>
				{% endif %}
				<tr><td colspan="10" class="info text-center">
					<a href="{{ row.group.get_absolute_url }}"><strong>{{ row.group.name }}</strong></a>
					<span class="pull-right">
						Всего участников: {{ row.group.n_participants }}, стартовало: {{ row.group.n_participants_started }}
					</span>
				</tr></td>
				<tr><th></th><th>Имя</th><th class="text-center">Год&nbsp;рожд.</th><th>Команда</th>
					<th>Стартов</th><th class="text-center">Очки</th><th>+</th><th colspan="3">Бонусы</th>
				</tr>
				{% for participant in row.participants %}{% with person=participant.klb_person %}
					<tr{% if person.gender == 1 %} class="success"{% endif %}>
						<td>{{ forloop.counter }}</td>
						<td>
							<a href="{{ person.get_absolute_url }}">{{ person.fname }} {{ person.lname }}</a>
							({{ person.city.nameWithCountry }})
						</td>
						<td class="text-center">{% if person.birthday %}{{ person.birthday.year }}{% endif %}</td>
						<td>{% if participant.team %}
								<a href="{{ participant.team.get_absolute_url }}">{{ participant.team.name }}</a>
							{% endif %}
						</td>
						<td class="text-center">{{ participant.n_starts }}</td>
						<td class="text-right">{{ participant.clean_sum|floatformat:3 }}</td>
						<td>+</td>
						<td class="text-right">{{ participant.bonus_sum|floatformat:3 }}</td>
						<td>=</td>
						<td class="text-right"><strong>{{ participant.score_sum|floatformat:3 }}</strong></td>
					</tr>
				{% endwith %}{% endfor %}
			{% endfor %}
		</table>
	</div>
</div>
{% endblock %}
